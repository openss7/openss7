#!/bin/sh
mkgenconf_ident="@(#) LiS mkgenconf 1.8 10/11/04"

. ${CONFIG:=config.in}

#
# Make genconf.h
#
# This is a generated header file that captures information
# gleaned from the kernel.  linux-mdep.h uses it to get this
# info without having to clutter the command line with lots
# of "-D" options.
#
mk_genconf_h()
{
    f=${GENCONF:-${SRCDIR}/include/sys/LiS/genconf.h}

    [ -d $(dirname $f) ] || mkdir -p $(dirname $f)
    : > $f

    echo '/* FILE GENERATED by mkgenconf -- DO NOT MODIFY */' >> $f
    echo "#define GET_EMPTY_INODE(LIS_SB) ${GET_EMPTY_INODE}" | \
	sed "s/LIS_SB/sb/g" >>$f
    if [ "$INT_PSW..." = "y..." ]; then
	echo "#define INT_PSW	1" >>$f
    fi
    if [ "$SET_CPUS_ALLOWED" = "y" ]; then
	echo "#define SET_CPUS_ALLOWED	1" >>$f
    else
	echo "#undef SET_CPUS_ALLOWED" >>$f
    fi
    echo "#define STREAMS_REGPARM	$STREAMS_REGPARM" >>$f
    CCREGPARM=`echo $CCREGPARM | sed -e's/.*=//'`
    echo "#define CCREGPARM	$CCREGPARM" >>$f
    if [ "$TARGET" = "l" ]; then
	if [ "$CCREGPARM" = "0" -a "$STREAMS_REGPARM" = "0" ]; then
	    echo "#define _RP     " >>$f
	else
	    echo "#define _RP  __attribute__ ((regparm($STREAMS_REGPARM)))" >>$f
	fi
    else
	echo "#define _RP     " >>$f
    fi
}

mk_genconf_h
